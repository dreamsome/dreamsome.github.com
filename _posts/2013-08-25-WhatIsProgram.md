---
layout: post
title: "什么是程序？"
tags : [arch]
---


### 高级语言

在高级语言层，程序由一些语句（statement）构成。

![](http://ww4.sinaimg.cn/mw690/534218ffjw1e7yoetxuudj20h007w0sp.jpg)


<!--more-->

### 汇编语言


高级语言可以翻译成抽象层次更低的汇编语言。汇编语言层的程序是由一个一个基本块（basic block）组成的。汇编语言通常会将寄存器暴露给程序员，但我们暂时先不考虑它们，这里的 abc 可以想象成“变量”，或“一个地方”。



![](http://ww3.sinaimg.cn/mw690/534218ffjw1e7yoew6of1j20i4086wes.jpg)

### 控制流图


我们对汇编语言进行一些抽象，把基本块想象成一个“黑盒子”，在这个黑盒子内部布了一些线路，这些电路实现了基本块中所有的计算，黑盒之间通过 abc 这些“变量”与外界通信。



![](http://ww4.sinaimg.cn/mw690/534218ffjw1e7yoeyi6tdj20i00cs0t9.jpg)


这样程序就变成了若干个盒子在**时间上的序列**。在有些情况下（a > 1）我们的程序模拟的是蓝色盒子，而在另一些情况下（ a <= 2）程序模拟的是黄色盒子，但无论如何程序都会“执行”接下来的红色盒子。不过在一个时刻，计算机至多只能模拟其中一个盒子。


盒子与盒子之间是消费者和生产者的关系，每个盒子都有一些“输入/输出”端口，比如黄色盒子的输入是 a，输出是 b 和 c，所以我们要把 a 和黄色盒子的前驱盒子的输出端口相连，然后把 b、c 与黄色盒子的后继盒子的输入端口相连。


由于每次计算机只能扮演一个盒子，所以实际并不能直接相连，而是必须先把值保存在某个地方，过一会再取出来，这个地方就是寄存器。


![](http://ww1.sinaimg.cn/mw690/534218ffjw1e7yof0tpzuj20i20d2dge.jpg)



寄存器的数量少得可怜，所以我们有时需要把值保存到更远但是也更大的内存中。


![](http://ww4.sinaimg.cn/mw690/534218ffjw1e7yof36p68j20im0ccaar.jpg)

### 回到汇编


现在我们打开黑盒，发现是一些加法器、乘法器连接的电路，为了模拟它们，CPU 必须先扮乘法器，把结果（状态）保存到寄存器中，然后再扮演加法器，进行接下来的计算，所以模拟一个黑盒的过程又可划分多个阶段。


![](http://ww1.sinaimg.cn/mw690/534218ffjw1e7yof5gcfjj20ho074wem.jpg)


### 时分复用


指令告诉 CPU 在某一时刻改变成什么样的电路，运算指令（对应的电路）计算值并修改寄存器，转移指令（对应的电路）修改程序计数器（PC），这样我们就能用有限数量的部件去完成无限的操作，处理无限多种可能性。因此通用计算可以看成是用（执行）时间换空间（部件）的一种方法。


![](http://ww2.sinaimg.cn/mw690/534218ffjw1e7yof5z2ghj20gg0awmxn.jpg)


